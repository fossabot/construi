image: python:2.7

default: test

volumes:
  - $PWD/.local:/root/.local

targets:
  versiune:
    image: lstephen/versiune:2.0.0-RC1
    run:
      - VERSION
      - -f python construi/__version__.py

  test_p27: &test_p
    before:
      - install
    run: python setup.py test

  test_p34:
    <<: *test_p
    image: python:3.4

  test:
    before:
      - test_p27
      - test_p34

  install:
    before:
      - versiune
    run:
      - python setup.py install --user

  package:
    before:
      - install
    run:
      - rm -rf dist
      - python setup.py sdist

  release:
    before:
      - package
    environment:
      - TWINE_USERNAME
      - TWINE_PASSWORD
    run:
      - /bin/sh -c "pip install twine && twine upload dist/* -u $TWINE_USERNAME -p $TWINE_PASSWORD"

  flake8: python setup.py flake8
  format: python setup.py yapf


